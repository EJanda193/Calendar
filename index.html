<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Weekly Calendar</title>
  <style>
    :root {
      --timeCol: 80px;       /* left time column width */
      --headerH: 40px;       /* day header height */
      --halfHourH: 30px;     /* height per 30 minutes */
      --hourH: 60px;         /* height per hour (derived) */
    }

    body {
      margin: 0;
      background: #111;
      color: #fff;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
    }

    h1 { text-align: center; margin: 18px 0 10px; }

    .controls {
      display: flex; flex-wrap: wrap; gap: 8px; justify-content: center;
      margin: 0 12px 12px;
    }
    .controls input, .controls select, .controls button {
      padding: 6px 8px; font-size: 14px; border-radius: 6px; border: none;
    }
    .controls button { background:#2e7d32; color:#fff; cursor:pointer; }

    /* Grid background (days + time lines) */
    .grid {
      position: relative;
      height: calc(100vh - 160px);
      border-top: 1px solid #333;
      border-left: 1px solid #333;
      display: grid;
      grid-template-columns: var(--timeCol) repeat(7, 1fr);
      /* header + 29 half-hour rows (8:00 → 10:00 inclusive) */
      grid-template-rows: var(--headerH) repeat(29, var(--halfHourH));
      background: #151515;
    }
    .grid > div {
      border-right: 1px solid #333;
      border-bottom: 1px solid #222;
      display: flex; align-items: center; justify-content: center;
      font-size: 12px;
    }
    .day-head { background:#222; font-weight: 700; }
    .time-cell { background:#101010; justify-content: flex-end; padding-right: 6px; color:#ddd; }

    /* Overlay for events */
    .overlay {
      pointer-events: none;
      position: absolute; inset: 0;
    }
    .event {
      position: absolute;
      pointer-events: auto;
      border-radius: 8px;
      padding: 6px 8px;
      color:#000;
      font-size: 12px;
      line-height: 1.25;
      box-shadow: 0 1px 6px rgba(0,0,0,.35);
      /* day positioning: width is (full width minus time column)/7 */
      width: calc((100% - var(--timeCol)) / 7 - 8px);
      left: calc(var(--timeCol) + var(--day) * ((100% - var(--timeCol)) / 7) + 4px);
      /* vertical positioning */
      top: calc(var(--headerH) + (var(--start) - 8) * var(--hourH));
      height: calc((var(--end) - var(--start)) * var(--hourH));
      background: var(--bg);
      border: 1px solid rgba(0,0,0,.15);
      overflow: hidden;
      white-space: pre-line;
    }

    /* faint half-hour lines across days */
    .row { grid-column: 1 / -1; border-bottom: 1px solid #1e1e1e; }
  </style>
</head>
<body>
  <h1>Weekly Calendar</h1>

  <div class="controls">
    <input id="code" placeholder="CIS*2030">
    <input id="type" placeholder="LEC">
    <input id="location" placeholder="Location (e.g. MACK 117)">
    <select id="day">
      <option>Mon</option><option>Tue</option><option>Wed</option>
      <option>Thu</option><option>Fri</option><option>Sat</option><option>Sun</option>
    </select>
    <input id="start-time" placeholder="1:30">
    <select id="start-meridian"><option>AM</option><option selected>PM</option></select>
    <input id="end-time" placeholder="2:20">
    <select id="end-meridian"><option>AM</option><option selected>PM</option></select>
    <button id="add">Add Course</button>
  </div>

  <!-- Background grid -->
  <div class="grid" id="grid">
    <!-- top-left blank -->
    <div></div>
    <!-- day headers -->
    <div class="day-head">Mon</div><div class="day-head">Tue</div><div class="day-head">Wed</div>
    <div class="day-head">Thu</div><div class="day-head">Fri</div><div class="day-head">Sat</div><div class="day-head">Sun</div>

    <!-- time labels + empty cells -->
  </div>

  <!-- Event overlay -->
  <div class="overlay" id="overlay"></div>

  <script>
    // ---------- build the grid (time labels every 30 min, 8:00 AM → 10:00 PM inclusive) ----------
    const grid = document.getElementById('grid');

    function label(h, m) {
      const ampm = h >= 12 ? 'PM' : 'AM';
      const h12 = ((h + 11) % 12) + 1;
      const mm = String(m).padStart(2,'0');
      return `${h12}:${mm} ${ampm}`;
    }

    // 29 half-hour rows: from 8:00 to 22:00 inclusive (8..22 => 14 hours => 29 rows)
    for (let i = 0; i < 29; i++) {
      const hour = 8 + Math.floor(i / 2);
      const mins = i % 2 ? 30 : 0;

      // time label
      const t = document.createElement('div');
      t.className = 'time-cell';
      t.textContent = label(hour, mins);
      grid.appendChild(t);

      // day cells (visual only)
      for (let d = 0; d < 7; d++) {
        const cell = document.createElement('div');
        grid.appendChild(cell);
      }
    }

    // ---------- color map per course code ----------
    const colorMap = {};
    const palette = ['#a2d2ff','#caffbf','#ffc6ff','#ffd6a5','#bdb2ff','#9bf6ff','#ffadad','#e0ffcd','#ffe5ec'];
    let colorIdx = 0;
    function colorFor(code) {
      const key = code.trim().toUpperCase();
      if (!colorMap[key]) colorMap[key] = palette[colorIdx++ % palette.length];
      return colorMap[key];
    }

    // ---------- time parsing ----------
    function toDecimal(timeStr, meridian) {
      const [hStr, mStr='0'] = timeStr.trim().split(':');
      let h = parseInt(hStr, 10);
      const m = parseInt(mStr, 10);
      if (Number.isNaN(h) || Number.isNaN(m)) return NaN;
      const mer = meridian.toUpperCase();
      if (mer === 'PM' && h !== 12) h += 12;
      if (mer === 'AM' && h === 12) h = 0;
      return h + m/60;
    }

    // ---------- add events ----------
    const overlay = document.getElementById('overlay');
    document.getElementById('add').addEventListener('click', () => {
      const code = document.getElementById('code').value.trim();
      const type = document.getElementById('type').value.trim();
      const loc  = document.getElementById('location').value.trim() || 'Location';
      const day  = document.getElementById('day').value;
      const sT   = document.getElementById('start-time').value;
      const sM   = document.getElementById('start-meridian').value;
      const eT   = document.getElementById('end-time').value;
      const eM   = document.getElementById('end-meridian').value;

      if (!code || !type || !sT || !eT) { alert('Please fill all fields.'); return; }

      const start = toDecimal(sT, sM);
      const end   = toDecimal(eT, eM);
      if (isNaN(start) || isNaN(end) || end <= start) { alert('Check your times.'); return; }
      if (start < 8 || end > 22) { alert('Times must be between 8:00 AM and 10:00 PM.'); return; }

      const dayIndex = ['Mon','Tue','Wed','Thu','Fri','Sat','Sun'].indexOf(day);
      const block = document.createElement('div');
      block.className = 'event';
      block.style.setProperty('--day', dayIndex);   // 0..6
      block.style.setProperty('--start', start);    // decimal hours
      block.style.setProperty('--end',   end);
      block.style.setProperty('--bg', colorFor(code));
      block.textContent = `${code} ${type}\n${loc}`;
      overlay.appendChild(block);
    });
  </script>
</body>
</html>
